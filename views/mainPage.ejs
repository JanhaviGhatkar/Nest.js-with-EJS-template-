<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><% if (Message) {%> <%= Message %> <%}%></title>
    <link
      rel="icon"
      href="https://th.bing.com/th/id/OIP.TEFGCq9meFGAI-HttxxCEQAAAA?rs=1&pid=ImgDetMain"
      type="image/x-icon"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #313131;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
        border: 1px solid #ddd;
        text-align: left;
      }
      th {
        font-weight: bold;
        background-color: #f2f2f2;
      }
      tr:hover {
        background-color: #f2f2f2;
      }
      .action-buttons {
        display: flex;
        justify-content: center;
      }
      .update-button,
      .delete-button {
        margin: 5px;
        padding: 5px 10px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      .update-button:hover,
      .delete-button:hover {
        background-color: #007bff;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>User Data</h1>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="allDataOfUser">
          <b>Registered Users </b>
        </tbody>
      </table>
    </div>

    <script>
      const tbody = document.getElementById('allDataOfUser');
      tbody.innerHTML = '';
      fetch('http://localhost:3000/user/allUsers', {
        method: 'get',
      })
        .then((response) => response.json())
        .then((data) => {
          // console.log(data.allData[0]);
          data.allData.forEach((element) => {
            const tr = document.createElement('tr');

            const tdId = document.createElement('td');
            tdId.innerHTML = element.id;
            tr.appendChild(tdId);

            const tdName = document.createElement('td');
            tdName.innerHTML = element.name;
            tr.appendChild(tdName);

            const tdEmail = document.createElement('td');
            tdEmail.innerHTML = element.email;
            tr.appendChild(tdEmail);

            const action = document.createElement('td');
            const updateBtn = document.createElement('button');
            updateBtn.classList = 'update-button';
            updateBtn.innerHTML = 'Update';
            updateBtn.onclick = function () {
              fillUser(element);
            };

            const deleteBtn = document.createElement('button');
            deleteBtn.classList = 'delete-button';
            deleteBtn.innerHTML = 'Delete';
            deleteBtn.onclick = function () {
              deleteUser(element.id);
            };
            action.appendChild(updateBtn);
            action.appendChild(deleteBtn);
            tr.appendChild(action);
            tbody.appendChild(tr);
          });
        });
      
        function fillUser(userData) {
          location.href = `http://localhost:3000/user-ui/userUpdation?id=${userData.id}&name=${userData.name}&email=${userData.email}`;
        }
      
      function deleteUser(id) {
        console.log(id);
        fetch(`http://localhost:3000/user/deleteUser/${id}`, {
          method: 'DELETE',
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error('Failed to delete user');
            }
            location.reload();
          })
          .catch((error) => {
            console.log(error.message);
            alert('Failed to delete user');
          });
      }
    </script>
  </body>
</html>
